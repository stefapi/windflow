# ============================================================================
# WindFlow - Docker Compose Principal (Redirecteur Intelligent)
# ============================================================================
# Ce fichier d√©tecte automatiquement le mode d'ex√©cution et redirige vers
# la configuration appropri√©e :
#   - Mode MINIMAL : Installation rapide (windflow + traefik uniquement)
#   - Mode DEV     : D√©veloppement complet (toutes extensions activ√©es)
#   - Mode PROD    : Production optimis√©e
# ============================================================================

version: '3.8'

# ==============================================================================
# UTILISATION
# ==============================================================================
#
# Installation minimale (recommand√© pour d√©marrer) :
#   docker compose -f docker-compose.minimal.yml up -d
#   OU
#   make minimal
#
# Mode d√©veloppement complet :
#   docker compose -f docker-compose-dev.yml up -d
#   OU
#   make dev-full
#
# Mode production :
#   docker compose -f docker-compose.prod.yml up -d
#   OU
#   make prod
#
# Activer des extensions sp√©cifiques :
#   make enable-database    # PostgreSQL
#   make enable-cache       # Redis
#   make enable-monitoring  # Prometheus + Grafana
#   make enable-secrets     # HashiCorp Vault
#   make enable-sso         # Keycloak SSO
#
# ==============================================================================

# ==============================================================================
# CONFIGURATION PAR D√âFAUT
# ==============================================================================
# Par d√©faut, ce fichier redirige vers le mode MINIMAL pour une installation
# rapide. Pour changer le comportement par d√©faut, d√©finissez la variable
# d'environnement WINDFLOW_MODE :
#
# export WINDFLOW_MODE=minimal  # Mode minimal (d√©faut)
# export WINDFLOW_MODE=dev      # Mode d√©veloppement
# export WINDFLOW_MODE=prod     # Mode production
#
# Puis lancez : docker compose up -d
# ==============================================================================

# Note: Ce fichier est un "meta" compose file. Il ne contient pas de services
# directement. Utilisez plut√¥t les fichiers sp√©cifiques :
#   - docker-compose.minimal.yml     (mode minimal)
#   - docker-compose-dev.yml         (mode d√©veloppement)
#   - docker-compose.prod.yml        (mode production)
#   - docker-compose.extensions.yml  (extensions optionnelles)

services:
  # Service factice pour afficher un message d'aide
  windflow-help:
    image: alpine:latest
    container_name: windflow-help
    command: >
      sh -c "
      echo '========================================';
      echo 'WindFlow - Docker Compose';
      echo '========================================';
      echo '';
      echo '‚ö†Ô∏è  Ce fichier est un redirecteur.';
      echo '';
      echo 'üì¶ Installation minimale (recommand√©) :';
      echo '   docker compose -f docker-compose.minimal.yml up -d';
      echo '   OU';
      echo '   make minimal';
      echo '';
      echo 'üîß Mode d√©veloppement complet :';
      echo '   docker compose -f docker-compose-dev.yml up -d';
      echo '   OU';
      echo '   make dev-full';
      echo '';
      echo 'üöÄ Mode production :';
      echo '   docker compose -f docker-compose.prod.yml up -d';
      echo '   OU';
      echo '   make prod';
      echo '';
      echo 'üìö Documentation : doc/EXTENSIONS-GUIDE.md';
      echo '========================================';
      sleep 10
      "
    restart: "no"

# ==============================================================================
# DOCUMENTATION RAPIDE
# ==============================================================================
#
# ARCHITECTURE MODULAIRE :
#
# WindFlow adopte une architecture modulaire avec un core minimal et des
# extensions optionnelles :
#
# CORE (< 512 MB, < 2 min) :
#   ‚úì windflow-api (FastAPI + SQLite)
#   ‚úì windflow-frontend (Vue.js 3)
#   ‚úì traefik (Reverse proxy)
#
# EXTENSIONS OPTIONNELLES :
#   ‚óã PostgreSQL (base de donn√©es externe)
#   ‚óã Redis (cache distribu√©)
#   ‚óã HashiCorp Vault (secrets management)
#   ‚óã Keycloak (SSO/SAML)
#   ‚óã Prometheus + Grafana (monitoring)
#
# COMMANDES RAPIDES :
#
#   make status              # Afficher l'√©tat des services
#   make logs                # Afficher les logs
#   make stop                # Arr√™ter tous les services
#   make restart             # Red√©marrer tous les services
#   make clean               # Nettoyer compl√®tement
#
# PLUS D'INFOS :
#   README.md                # Guide de d√©marrage
#   doc/EXTENSIONS-GUIDE.md  # Guide des extensions
#   doc/ARCHITECTURE-MODULAIRE.md # Architecture d√©taill√©e
#
# ==============================================================================
